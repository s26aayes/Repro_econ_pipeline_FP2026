(directory_structure)=

# Directory Structure

## The big picture

The following graph shows the contents of template_project root directory after
executing `pytask`

```{mermaid}
flowchart LR
    Root["project root"]

    Src["src/"]
    SrcSub["template_project/"]
    SrcSubDir["analysis/<br/>data/<br/>data_management/<br/>final/<br/>\_\_init\_\_.py<br/>config.py"]
    Tests["tests/"]
    Documents["documents/"]
    DocumentsSource["paper.md<br/>presentation.md<br/>refs.bib"]
    DocumentsOutput["public/<br/>tables/"]
    Bld["bld/"]
    BldSub["data/<br/>figures/<br/>tables/<br/>models/<br/>predictions/"]
    Build["_build/"]
    BuildSub["html/<br/>exports/"]
    Paper["paper.pdf"]
    Presentation["presentation.pdf"]
    MystYml["myst.yml"]

    Root --> Src
    Root --> Tests
    Root --> MystYml
    Root --> Documents
    Root --> Bld
    Root --> Build
    Root --> Paper
    Root --> Presentation

    Src --> SrcSub
    SrcSub --> SrcSubDir
    Documents --> DocumentsSource
    Documents --> DocumentsOutput
    Bld --> BldSub
    Build --> BuildSub

    style Root fill:#04A96D,stroke:#333,stroke-width:2px,color:#fff
    style Src fill:#4d7f9c,stroke:#333,stroke-width:2px,color:#fff
    style SrcSub fill:#4d7f9c,stroke:#333,stroke-width:2px,color:#fff
    style SrcSubDir fill:#4d7f9c,stroke:#333,stroke-width:1px,color:#fff
    style Tests fill:#4d7f9c,stroke:#333,stroke-width:2px,color:#fff
    style MystYml fill:#4d7f9c,stroke:#333,stroke-width:2px,color:#fff
    style Documents fill:#04A96D,stroke:#333,stroke-width:2px,color:#fff
    style DocumentsSource fill:#4d7f9c,stroke:#333,stroke-width:1px,color:#fff
    style DocumentsOutput fill:#E88B00,stroke:#333,stroke-width:1px,color:#fff
    style Bld fill:#FBBB06,stroke:#333,stroke-width:2px,color:#000
    style BldSub fill:#FBBB06,stroke:#333,stroke-width:1px,color:#000
    style Build fill:#FBBB06,stroke:#333,stroke-width:2px,color:#000
    style BuildSub fill:#FBBB06,stroke:#333,stroke-width:1px,color:#000
    style Paper fill:#FBBB06,stroke:#333,stroke-width:2px,color:#000
    style Presentation fill:#FBBB06,stroke:#333,stroke-width:2px,color:#000
```

**Color legend:**

- **Blue** — Source code written by the researcher
- **Yellow** — Build outputs generated by pytask
- **Green** — Project root and document container directories
- **Orange** — Intermediate outputs (generated files that serve as inputs to document
  compilation)

The **separation of inputs and outputs** (one of our guiding principles) is visible at a
glance:

- **Source code** (blue) in `src/` and `tests/` is written by the researcher
- **Computational outputs** (yellow) are generated into `bld/` by the analysis pipeline
- **Document outputs** (yellow) are generated into `_build/` by the document compilation
- **Intermediate outputs** (orange) in `documents/public/` and `documents/tables/` are
  figures and tables generated by the analysis pipeline that serve as inputs to document
  compilation

The figures and tables live inside `documents/` rather than `bld/` because document
tools (MyST and Slidev) expect assets to be near the source files. The `public/`
directory name is required by Slidev for static assets.

```{note}
The paper PDF and presentation PDF are copied to the project root for easy access. The
paper is also available as an interactive HTML site in `_build/html/`.
```

## Viewing papers and presentations

The paper is built in both PDF and HTML formats. Use these commands to view outputs
interactively with live reload:

```bash
pixi run view-paper   # View paper in browser (HTML with live reload)
pixi run view-pres    # View presentation in browser (Slidev with live reload)
```

For the project documentation (this site), use:

```bash
pixi run -e docs view-docs
```

The contents of `src/template_project/` follow the steps of the analysis workflow, with
subdirectories for data management, analysis, and final output generation.

All outputs from these steps are placed in the `bld/` directory, organized by type:

- Data processing outputs go to `bld/data/`
- Model outputs go to `bld/models/` and `bld/predictions/`
- Final figures go to `bld/figures/`
- Final tables go to `bld/tables/`

Document build outputs (HTML site and PDF exports) go to `_build/` at the project root.

## Documents directory structure

The `documents/` directory contains the source files for papers and presentations:

- **`paper.md`**: The main paper written in [MyST Markdown](https://mystmd.org/),
  compiled to PDF and HTML using
  [Jupyter Book 2.0](https://jupyterbook.org/stable/get-started/init/)
- **`presentation.md`**: The presentation written in [Slidev](https://sli.dev/) Markdown
  format
- **`refs.bib`**: Bibliography file in BibTeX format
- **`style.css`**: Custom CSS styling for the presentation
- **`public/`**: Generated figure files (PNG) referenced by both the paper and
  presentation. Slidev requires this directory name for static assets.
- **`tables/`**: Generated table files (Markdown) included in MyST documents via the
  `{include}` directive

The configuration file **`myst.yml`** lives in the **project root** (not inside
`documents/`) because Jupyter Book 2.0 expects it at the working directory where
`jupyter book build` is run. This file defines project metadata, bibliography settings,
and PDF export options.

The tasks in `src/template_project/final/task_final_template.py` generate figures and
tables into `documents/public/` and `documents/tables/` respectively. These are then
included in the paper and presentation using MyST Markdown directives (e.g., `{figure}`
and `{include}`).

## Zooming in

Lets go one step deeper and consider the root/src directory in more detail:

```{mermaid}
flowchart LR
    Root["src/template_project/"]

    Analysis["analysis/"]
    Data["data/"]
    DataMgmt["data_management/"]
    Final["final/"]
    Config["\_\_init\_\_.py<br/>config.py"]

    AnalysisFiles["\_\_init\_\_.py<br/>model_template.py<br/>predict_template.py<br/>task_analysis_template.py"]
    DataFiles["stats4schools_smoking_template.csv"]
    DataMgmtFiles["\_\_init\_\_.py<br/>stats4schools_smoking_template.py<br/>task_data_management_template.py"]
    FinalFiles["\_\_init\_\_.py<br/>plot_template.py<br/>task_final_template.py"]

    Root --> Analysis
    Root --> Data
    Root --> DataMgmt
    Root --> Final
    Root --> Config

    Analysis --> AnalysisFiles
    Data --> DataFiles
    DataMgmt --> DataMgmtFiles
    Final --> FinalFiles

    style Root fill:#4d7f9c,stroke:#333,stroke-width:2px,color:#fff
    style Analysis fill:#4d7f9c,stroke:#333,stroke-width:2px,color:#fff
    style Data fill:#4d7f9c,stroke:#333,stroke-width:2px,color:#fff
    style DataMgmt fill:#4d7f9c,stroke:#333,stroke-width:2px,color:#fff
    style Final fill:#4d7f9c,stroke:#333,stroke-width:2px,color:#fff
    style Config fill:#4d7f9c,stroke:#333,stroke-width:2px,color:#fff
    style AnalysisFiles fill:#4d7f9c,stroke:#333,stroke-width:1px,color:#fff
    style DataFiles fill:#4d7f9c,stroke:#333,stroke-width:1px,color:#fff
    style DataMgmtFiles fill:#4d7f9c,stroke:#333,stroke-width:1px,color:#fff
    style FinalFiles fill:#4d7f9c,stroke:#333,stroke-width:1px,color:#fff
```

It is imperative that you do all the task handling inside the `task_xxx.py`-scripts,
using the [pathlib](https://realpython.com/python-pathlib/) library. This ensures that
your project can be used on different machines and it minimises the potential for
cross-platform errors.

For running Python source code from pytask, simply include `pathlib.Path`s to the
dependencies and similar path(s) for the special keyword `produces` as the default
arguments to your function.

For running scripts in other languages, pass all required files (inputs, log files,
outputs) as arguments to the `@pytask.mark.[x]`-decorator. You can then read them in.
Check the sections on different programming languages for examples.
